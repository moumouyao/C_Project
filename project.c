#include <stdio.h>
#include <stdint.h>
// 汉字字模数据
unsigned char han[][32][4] = {
    {
        {0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},
{0x00,0x40,0x00,0x00},
{0x00,0x70,0x60,0x00},
{0x00,0x60,0xE0,0x00},
{0x00,0xE0,0xC0,0x00},
{0x00,0xC0,0xC0,0x00},
{0x00,0xC1,0x80,0x00},
{0x01,0x81,0x80,0x18},
{0x01,0x03,0xFF,0xFC},
{0x03,0x03,0x00,0x18},
{0x03,0x86,0x10,0x30},
{0x07,0x84,0x0C,0x20},
{0x0D,0x8C,0x08,0x40},
{0x09,0x88,0x08,0x00},
{0x11,0x90,0x08,0x00},
{0x11,0x81,0x88,0x00},
{0x21,0x83,0x88,0x80},
{0x01,0x83,0x08,0x40},
{0x01,0x83,0x08,0x20},
{0x01,0x86,0x08,0x30},
{0x01,0x86,0x08,0x18},
{0x01,0x8C,0x08,0x1C},
{0x01,0x88,0x08,0x0C},
{0x01,0x90,0x08,0x0C},
{0x01,0x90,0x08,0x0C},
{0x01,0xA0,0x08,0x00},
{0x01,0x80,0x08,0x00},
{0x01,0x80,0xF8,0x00},
{0x01,0x80,0x38,0x00},
{0x01,0x00,0x10,0x00},
{0x00,0x00,0x00,0x00}
// Add more data for the first Chinese character here...
},
{
   {0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},
{0x01,0x00,0x00,0x00},
{0x01,0xC0,0x00,0x00},
{0x01,0x80,0x00,0x20},
{0x01,0x81,0xFF,0xF0},
{0x01,0x80,0x00,0x70},
{0x01,0x00,0x00,0xC0},
{0x03,0x08,0x00,0x80},
{0x3F,0xFC,0x01,0x00},
{0x03,0x08,0x06,0x00},
{0x03,0x08,0x06,0x00},
{0x02,0x18,0x06,0x00},
{0x06,0x18,0x06,0x00},
{0x06,0x18,0x06,0x00},
{0x04,0x18,0x06,0x18},
{0x04,0x17,0xFF,0xFC},
{0x0C,0x30,0x06,0x00},
{0x0C,0x30,0x06,0x00},
{0x08,0x30,0x06,0x00},
{0x08,0x60,0x06,0x00},
{0x0E,0x60,0x06,0x00},
{0x01,0xC0,0x06,0x00},
{0x00,0xF0,0x06,0x00},
{0x00,0xBC,0x06,0x00},
{0x01,0x8C,0x06,0x00},
{0x03,0x04,0x06,0x00},
{0x04,0x00,0x06,0x00},
{0x08,0x00,0xFC,0x00},
{0x30,0x00,0x1C,0x00},
{0x00,0x00,0x08,0x00},
{0x00,0x00,0x00,0x00}
// Add data for the second Chinese character here...
},
{
{0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},
{0x00,0x04,0x02,0x00},
{0x00,0x07,0x03,0x80},
{0x00,0x06,0x03,0x00},
{0x02,0x06,0x03,0x00},
{0x03,0x86,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x18},
{0x7F,0xFF,0xFF,0xFC},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x07,0xFF,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x06,0x03,0x00},
{0x03,0x04,0x00,0x00},
{0x03,0x00,0x00,0x00},
{0x03,0x00,0x00,0x00},
{0x03,0x00,0x00,0x18},
{0x07,0xFF,0xFF,0xFC},
{0x01,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},/*"世",0*/
/* (32 X 32 , 宋体 )*/
    },
    {
    {0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00},
{0x01,0x00,0x00,0x80},
{0x01,0xFF,0xFF,0xC0},
{0x01,0x81,0x80,0xC0},
{0x01,0x81,0x80,0x80},
{0x01,0x81,0x80,0x80},
{0x01,0xFF,0xFF,0x80},
{0x01,0x81,0x80,0x80},
{0x01,0x81,0x80,0x80},
{0x01,0x81,0x80,0x80},
{0x01,0x81,0x80,0x80},
{0x01,0xFF,0xFF,0x80},
{0x01,0x86,0x20,0x80},
{0x00,0x06,0x10,0x00},
{0x00,0x0C,0x08,0x00},
{0x00,0x18,0x04,0x00},
{0x00,0x38,0x03,0x00},
{0x00,0xEE,0x0D,0xF0},
{0x01,0x8C,0x0C,0x7C},
{0x06,0x0C,0x0C,0x18},
{0x38,0x18,0x0C,0x00},
{0x00,0x18,0x0C,0x00},
{0x00,0x18,0x0C,0x00},
{0x00,0x30,0x0C,0x00},
{0x00,0x30,0x0C,0x00},
{0x00,0x60,0x0C,0x00},
{0x01,0x80,0x0C,0x00},
{0x06,0x00,0x0C,0x00},
{0x18,0x00,0x08,0x00},
{0x00,0x00,0x00,0x00},/*"界",1*/
/* (32 X 32 , 宋体 )*/
    }
    // Add more Chinese characters as needed...
};


// BMP文件头部结构体
#pragma pack(2)
typedef struct {
    uint16_t signature; // 文件标识符 "BM" (0x424D)
    uint32_t file_size; // 文件大小（单位：字节）
    uint16_t reserved1; // 保留字段1，值为0
    uint16_t reserved2; // 保留字段2，值为0
    uint32_t data_offset; // 数据偏移量（即图像数据相对于文件起始位置的偏移量）
} BMPHeader;
#pragma pack()

// BMP信息头结构体
#pragma pack(2)
typedef struct {
    uint32_t header_size; // 信息头大小（通常为40字节）
    int32_t width; // 图像宽度（单位：像素）
    int32_t height; // 图像高度（单位：像素）
    uint16_t planes; // 颜色平面数，值为1
    uint16_t bit_count; // 每个像素的位数（通常为24，即RGB888格式）
    uint32_t compression; // 压缩类型（通常为0，表示不压缩）
    uint32_t image_size; // 图像大小（单位：字节，如果为0，表示不压缩）
    int32_t x_pixels_per_meter; // 水平分辨率（单位：像素/米）
    int32_t y_pixels_per_meter; // 垂直分辨率（单位：像素/米）
    uint32_t colors_used; // 使用的颜色索引数，值为0表示使用所有的颜色索引
    uint32_t colors_important; // 重要颜色索引数，值为0表示所有颜色索引都重要
} BMPInfoHeader;
#pragma pack()


// Function to generate BMP file with specified number of Chinese characters
void generate_bmp_with_hanzi(const char* filename, int num_hanzi) {
    // 创建BMP文件头部
    BMPHeader bmp_header = {
        .signature = 0x4D42, // "BM"
        .file_size = sizeof(BMPHeader) + sizeof(BMPInfoHeader) + 32 * num_hanzi * 32 * 3, // BMP文件大小
        .reserved1 = 0,
        .reserved2 = 0,
        .data_offset = sizeof(BMPHeader) + sizeof(BMPInfoHeader) // 数据偏移量
    };

    // 创建BMP信息头
    BMPInfoHeader bmp_info_header = {
        .header_size = sizeof(BMPInfoHeader), // 信息头大小
        .width = 32 * num_hanzi, // 图像宽度
        .height = 32, // 图像高度（正数表示图像数据是从上往下排列的）
        .planes = 1,
        .bit_count = 24, // RGB888格式
        .compression = 0, // 不压缩
        .image_size = 0, // 图像大小（不压缩情况下可以设置为0）
        .x_pixels_per_meter = 0,
        .y_pixels_per_meter = 0,
        .colors_used = 0,
        .colors_important = 0
    };

    // 打开文件
    FILE* bmp_file = fopen(filename, "wb");
    if (bmp_file == NULL) {
        printf("Error: Cannot open file.\n");
        return;
    }

    // 写入BMP文件头部和信息头
    fwrite(&bmp_header, sizeof(BMPHeader), 1, bmp_file);
    fwrite(&bmp_info_header, sizeof(BMPInfoHeader), 1, bmp_file);

    for (int i = 32; i > 0; i--) {
        for (int k = 0; k < num_hanzi; k++) { // Iterate through Chinese characters
            for (int j = 0; j < 32; j++) {
                // 根据字模数据判断当前像素的颜色（黑色或白色）
                uint8_t pixel_data[3];
                if ((han[k][i][j / 8] & (0x80 >> (j % 8))) != 0) {
                    // 当前像素为黑色
                    pixel_data[0] = 255; // R
                    pixel_data[1] = 255; // G
                    pixel_data[2] = 255; // B
                }
                else {
                    // 当前像素为白色
                    pixel_data[0] = 0; // R
                    pixel_data[1] = 0; // G
                    pixel_data[2] = 0; // B
                }
                // 写入像素数据
                fwrite(pixel_data, sizeof(uint8_t), 3, bmp_file);
            }
        }
    }

    // 关闭文件
    fclose(bmp_file);

    printf("BMP file generated successfully.\n");
}

int main(void) {
    generate_bmp_with_hanzi("hello.bmp", 4); // 生成包含两个汉字的BMP文件

    return 0;
}